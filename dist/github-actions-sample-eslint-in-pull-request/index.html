<!DOCTYPE html>
<html lang="zh-CN">

  
<head>
  <meta charset="utf-8">
  <meta name="author" content="è‘£æ²…é‘«, yuanxin.me@gmail.com" />
  
  
  
  <title>7. GitHub Actions - åœ¨pull requestä¸­æ‰§è¡Œeslintæ£€æµ‹çš„å·¥ä½œæµä¾‹å­ | TaoLiuJun&#39;s Blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="å·¥ç¨‹åŒ–,github actions," />
  

  <script>
    console.log('\n%c Hexo-theme-bmw v4.0 ' + '%c ğŸ‰ https://github.com/dongyuanxin/theme-bmw ğŸ‰\n' + '\n%c View demo online ' + '%c ğŸ” https://godbmw.com/ ğŸ”  \n' , 'color: #fadfa3; background: #030307; padding:3px 0;', '', 'color: #fadfa3; background: #030307; padding:3px 0;', '');
  </script>

  
    <meta name="description" content="Html/Css/JavaScript/TypeScriptçš„å­¦ä¹ å¿ƒå¾—ï¼›Reactçš„å­¦ä¹ å¿ƒå¾—ï¼›æŠ€æœ¯è®¾è®¡æ€æƒ³ï¼›ç”Ÿæ´»éšæƒ³ï¼›">
  

  

  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/touch-icon.png">
  

  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/blog/css/base.css">
<link rel="stylesheet" href="/blog/icon/iconfont.css">
<link rel="stylesheet" href="/blog/css/github-markdown.css">
<link rel="stylesheet" href="/blog/css/highlight.css">


  
<script src="/blog/js/util.js"></script>
<script src="/blog/js/valine.min.js"></script>


  

  

  
  
  <script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js" async></script>
  
  

<meta name="generator" content="Hexo 6.3.0"></head>

  <body>

    

    <div id="app">

      <div class="header-wrap">
  <header>
    <div class="site-brand">
      <div class="site-title">
        <a href="/blog/">Taoliujun&#39;s Blog</a>
      </div>
    </div>
    <nav class="site-navigation">
      <ul class="nav-menu">
      
        <li class="nav-item" data-path="/">
          
            <a 
              href="/blog/"
              target="_self"
            >
              ä¸»é¡µ
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/archives/">
          
            <a 
              href="/blog/archives/"
              target="_self"
            >
              æ‰€æœ‰æ–‡ç« 
            </a>
          
        </li>
      
        <li class="nav-item" data-path="https://github.com/taoliujun/blog/issues">
          
            <a 
              href="https://github.com/taoliujun/blog/issues"
              target="_self"
            >
              github
            </a>
          
        </li>
      
      </ul>
    </nav>
    <i class="iconfont icon-menu"></i>
  </header>
</div>

<script>
  let links = document.querySelectorAll('.nav-item');
  for(let link of links){
    let childrenLink = link.querySelector('ul');
    link.addEventListener('mouseenter', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown active";
      }
    })
    link.addEventListener('mouseleave', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown";
      }
    })
  }
  let rootRealPath = getRealPath(window.location.pathname, true);
  for(let link of links) {
    let linkPath = link.getAttribute("data-path");
    if(linkPath && getRealPath(linkPath, true) === rootRealPath) {
      link.className = "nav-item hover";
    }
  }

  let iconMenu = document.querySelector("i.iconfont.icon-menu"),
    iconMenuClicked = false;
  let navDOM = document.querySelector("nav.site-navigation");
  iconMenu.addEventListener("click", () => {
    iconMenuClicked 
      ? navDOM.className = "site-navigation active"
      : navDOM.className = "site-navigation";
    iconMenuClicked = !iconMenuClicked;
  })
</script>

      








<div class="container post-index">

  

<div class="post">
  <h1 class="article-title">
    <span>7. GitHub Actions - åœ¨pull requestä¸­æ‰§è¡Œeslintæ£€æµ‹çš„å·¥ä½œæµä¾‹å­</span>
  </h1>
  <div class="article-top-meta">
    <span>
      å‘å¸ƒ : 
      2023-12-28
    </span>
    
      <span>
        åˆ†ç±» : 
          <a href="/blog/categories/%E5%B7%A5%E7%A8%8B%E5%8C%96/">
            å·¥ç¨‹åŒ–
          </a>
      </span>
    
    
  </div>

  

  <div class="article-content">
    <div class="markdown-body">
      <p>åŸæ–‡é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://github.com/taoliujun/blog/issues/36">https://github.com/taoliujun/blog/issues/36</a></p>
<!--hexo
---
url: github-actions-sample-eslint-in-pull-request
tags:
  - github actions
---
-->

<p>ä¸€ä¸ªåœ¨pull requestå‘èµ·çš„æ—¶å€™æ‰§è¡Œeslintæ£€æµ‹çš„workflowï¼Œ<a target="_blank" rel="noopener" href="https://github.com/taoliujun/npm-packages/blob/master/.github/workflows/check-pull-request.yml">ç‚¹æ­¤æŸ¥çœ‹å®Œæ•´ä»£ç </a>ï¼Œå®ƒå®ç°çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li>åœ¨pull requeståˆ›å»ºã€æ›´æ–°çš„æ—¶å€™æ‰§è¡Œã€‚</li>
<li>å…ˆå›å¤ä¸€ä¸ªè¯„è®ºï¼Œå‘Šè¯‰ç”¨æˆ·æ­£åœ¨è¿è¡Œã€‚</li>
<li>åˆå§‹åŒ–ä»“åº“ï¼Œå¹¶å®‰è£…ä¾èµ–ï¼Œäº§ç”Ÿä¾èµ–ç¼“å­˜ã€‚</li>
<li>è¿è¡Œeslintå¢é‡æ£€æŸ¥ã€‚</li>
<li>è¿è¡Œtypescriptæ£€æŸ¥ã€‚</li>
<li>è¿è¡Œjestæ£€æŸ¥ã€‚</li>
<li>æ›´æ–°ä¹‹å‰çš„è¯„è®ºï¼Œå›å¤æ£€æŸ¥çš„ç»“æœã€‚</li>
</ul>
<p>è¿è¡Œæˆªå›¾ï¼š</p>
<p><img src="https://github.com/taoliujun/blog/assets/5689134/09c86bc1-ada1-41c3-9f8f-7e6c46f8204e" alt="Alt text"></p>
<p>ä¸ºé¿å…æ­§ä¹‰ï¼Œæ¶‰åŠåˆ°github actionçš„æœ¯è¯­éƒ½æ˜¯è‹±æ–‡çš„ã€‚æœ¯è¯­ä»‹ç»å¦‚ä¸‹ï¼š</p>
<ul>
<li>workflowï¼Œå·¥ä½œæµï¼Œå¯ä»¥ç†è§£ä¸ºymlæ–‡ä»¶ã€‚</li>
<li>jobsï¼Œå·¥ä½œï¼Œä¸€ä¸ªworkflowå¯ä»¥åŒ…å«å¤šä¸ªjobï¼Œå¹¶è¡Œæ‰§è¡Œã€‚</li>
<li>stepsï¼Œä½œä¸šï¼Œä¸€ä¸ªjobå¯ä»¥åŒ…å«å¤šä¸ªstepï¼Œä¸²è¡Œæ‰§è¡Œã€‚</li>
<li>actionï¼Œæ“ä½œï¼Œä½œä¸šä¸­å…·ä½“çš„æ‰§è¡Œã€‚</li>
</ul>
<h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/taoliujun/blog/issues/36#issuecomment-1871790603">åˆå§‹åŒ–workflow</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/taoliujun/blog/issues/36#issuecomment-1871806576">reply checking</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/taoliujun/blog/issues/36#issuecomment-1871818126">.&#x2F;.github&#x2F;actions&#x2F;unique-comment</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/taoliujun/blog/issues/36#issuecomment-1871862632">init</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/taoliujun/blog/issues/36#issuecomment-1871862779">eslint</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/taoliujun/blog/issues/36#issuecomment-1871862850">typescript</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/taoliujun/blog/issues/36#issuecomment-1871863037">unit test</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/taoliujun/blog/issues/36#issuecomment-1871863117">reply result</a></li>
</ul>
<!--hexo-->

<h1 id="åˆå§‹åŒ–workflow"><a href="#åˆå§‹åŒ–workflow" class="headerlink" title="åˆå§‹åŒ–workflow"></a>åˆå§‹åŒ–workflow</h1><p>åœ¨é¡¹ç›®ä¸­æ–°å»ºæ–‡ä»¶<code>.github/workflows/check-pull-request.yml</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">test</span> <span class="string">check</span> <span class="string">pull</span> <span class="string">request</span></span><br><span class="line"><span class="attr">run-name:</span> <span class="string">&#x27;check pull request #$<span class="template-variable">&#123;&#123; github.event.pull_request.number &#125;&#125;</span>&#x27;</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">    <span class="attr">pull_request:</span></span><br><span class="line">        <span class="attr">types:</span> [<span class="string">opened</span>, <span class="string">synchronize</span>, <span class="string">reopened</span>]</span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">    <span class="attr">replyChecking:</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&#x27;replyChecking&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">init:</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&#x27;init&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">eslint:</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">needs:</span> [<span class="string">init</span>]</span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&#x27;eslint&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">typescript:</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">needs:</span> [<span class="string">init</span>]</span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&#x27;typescript&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">unitTest:</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">needs:</span> [<span class="string">init</span>]</span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&#x27;unitTest&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">replyResult:</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">needs:</span> [<span class="string">replyChecking</span>, <span class="string">eslint</span>, <span class="string">typescript</span>, <span class="string">unitTest</span>]</span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&#x27;replyResult&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="nameå’Œrun-name"><a href="#nameå’Œrun-name" class="headerlink" title="nameå’Œrun-name"></a>nameå’Œrun-name</h2><p>ç»™workflowå‘½åä¸º<code>check pull request</code>ï¼Œå®ƒä¼šå‡ºç°åœ¨Actionsé¡µé¢çš„å·¦ä¾§èœå•ä¸­ã€‚è¿è¡Œå®ä¾‹åä¸º<code>check pull request #44</code>ï¼Œå‡ºç°åœ¨å³ä¾§çš„è¿è¡Œåˆ—è¡¨ä¸­ã€‚å¦‚å›¾ï¼š</p>
<p><img src="https://github.com/taoliujun/blog/assets/5689134/c1371ff2-8fc3-4e5b-8b60-3c572419938b"></p>
<p><code>run-name</code>ä¸­çš„<code>$&#123;&#123; github.event.pull_request.number &#125;&#125;</code>æ˜¯workflowçš„ä¸Šä¸‹æ–‡ï¼Œè¿™é‡Œè¯»å–äº†ä¸Šä¸‹æ–‡ä¸­çš„prç¼–å·ã€‚</p>
<h2 id="on"><a href="#on" class="headerlink" title="on"></a>on</h2><p><code>on</code>æŒ‡å®šäº†workflowçš„è§¦å‘æ¡ä»¶ï¼Œè¿™é‡Œé…ç½®äº†åœ¨pråˆ›å»ºã€åŒæ­¥ã€é‡æ–°æ‰“å¼€çš„æ—¶å€™ï¼Œè§¦å‘è¯¥workflowã€‚</p>
<h2 id="jobs"><a href="#jobs" class="headerlink" title="jobs"></a>jobs</h2><p>æŒ‰ç…§è®¾æƒ³ï¼Œéœ€è¦å®šä¹‰å‡ ä¸ªjobï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>replyCheckingï¼šå›å¤ç”¨æˆ·æ­£åœ¨æ£€æŸ¥ä¸­</li>
<li>initï¼šåˆå§‹åŒ–ä»“åº“ï¼Œç¼“å­˜ä¾èµ–é¡¹</li>
<li>eslintï¼šè¿è¡Œeslintæ£€æŸ¥</li>
<li>typescriptï¼šè¿è¡Œtypescriptæ£€æŸ¥</li>
<li>unitTestï¼šè¿è¡Œå•å…ƒæµ‹è¯•</li>
<li>replyResultï¼šå›å¤ç”¨æˆ·æ£€æŸ¥ç»“æœ</li>
</ul>
<p><code>jobs</code>æ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œèªæ˜å¦‚ä½ è‚¯å®šå‘ç°äº†ï¼Œeslintã€typescriptã€unitTestè¿™ä¸‰ä¸ªjobä¼šæ¶‰åŠåˆ°å®‰è£…npmä¾èµ–ï¼Œæ‰€ä»¥å®ƒä»¬æœ€å¥½åœ¨initåæ‰§è¡Œï¼Œç¡®ä¿ä¾èµ–å·²ç»ç¼“å­˜äº†ã€‚</p>
<p>å…¶æ¬¡ï¼ŒreplyResultè‚¯å®šè¦æ‹¿åˆ°eslintç­‰jobçš„ç»“æœæ‰èƒ½æ‰§è¡Œï¼Œæ‰€ä»¥ä½¿ç”¨äº†<code>needs</code>ç®¡ç†å®ƒä»¬çš„æ‰§è¡Œä¾èµ–å…³ç³»ã€‚</p>
<h3 id="runs-on"><a href="#runs-on" class="headerlink" title="runs-on"></a>runs-on</h3><p>æ¯ä¸ªjobéƒ½è¿è¡Œåœ¨ç‹¬ç«‹çš„å®¹å™¨ä¸­ï¼Œgithubå®˜æ–¹æä¾›äº†windowsã€macosã€linuxå¤šç§å®¹å™¨ï¼Œè¿™é‡Œä½¿ç”¨äº†ubuntuå®¹å™¨ã€‚</p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>å‘èµ·ä¸€ä¸ªprï¼Œçœ‹åˆ°Actionsé¡µé¢å‡ºç°äº†æ–°çš„è¿è¡Œå®ä¾‹ï¼Œç‚¹å‡»è¿›å»ï¼Œå¯ä»¥çœ‹åˆ°å„ä¸ªjobçš„è¿è¡Œæƒ…å†µå’Œä¾èµ–å…³ç³»ï¼š</p>
<p><img src="https://github.com/taoliujun/blog/assets/5689134/09c86bc1-ada1-41c3-9f8f-7e6c46f8204e"></p>
<!--hexo-->

<h1 id="replyChecking"><a href="#replyChecking" class="headerlink" title="replyChecking"></a>replyChecking</h1><p>åœ¨è¿›è¡Œeslintæ£€æµ‹ä¹‹å‰ï¼Œå…ˆåœ¨pré‡Œå›å¤<code>checking</code>ï¼Œå¹¶ä¸”å¸¦ä¸Šæ‹½é…·ç‚«çš„è¯ã€‚å°†replyCheckingæ”¹æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">replyChecking:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">          <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">          <span class="attr">with:</span></span><br><span class="line">              <span class="attr">ref:</span> <span class="string">$&#123;&#123;github.head_ref&#125;&#125;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">date</span> <span class="string">time</span></span><br><span class="line">          <span class="attr">id:</span> <span class="string">getDateTime</span></span><br><span class="line">          <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;result=$(TZ=Asia/Shanghai date)&quot;</span> <span class="string">&gt;&gt;</span> <span class="string">&quot;$GITHUB_OUTPUT&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">or</span> <span class="string">update</span> <span class="string">a</span> <span class="string">comment</span></span><br><span class="line">          <span class="attr">uses:</span> <span class="string">./.github/actions/unique-comment</span></span><br><span class="line">          <span class="attr">with:</span></span><br><span class="line">              <span class="attr">uniqueIdentifier:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.workflow</span> <span class="string">&#125;&#125;</span></span><br><span class="line">              <span class="attr">body:</span> <span class="string">|</span></span><br><span class="line"><span class="string">                  **Checking...**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">                  <span class="string">---</span></span><br><span class="line"></span><br><span class="line">                  <span class="string">Commented</span> <span class="string">by</span> <span class="string">Action</span> [<span class="string">$<span class="template-variable">&#123;&#123;github.workflow&#125;&#125;</span></span>]<span class="string">($&#123;&#123;github.event.repository.html_url&#125;&#125;/actions/runs/$&#123;&#123;github.run_id&#125;&#125;),</span> <span class="string">last</span> <span class="string">updated</span> <span class="string">on</span> <span class="string">$&#123;&#123;steps.getDateTime.outputs.result&#125;&#125;.</span></span><br></pre></td></tr></table></figure>

<p><code>steps</code>æ¯ä¸€æ­¥é‡Œ<code>name</code>ã€<code>id</code>æ˜¯å¯é€‰çš„ï¼Œ<code>name</code>åœ¨Actionsè¯¦æƒ…é¡µé¢é‡Œä¼šæ˜¾ç¤ºï¼Œæ›´ç›´è§‚çš„çœ‹åˆ°stepçš„åç§°ï¼Œæ¨èå†™ä¸Šã€‚</p>
<h2 id="Checkout"><a href="#Checkout" class="headerlink" title="Checkout"></a>Checkout</h2><p><code>uses</code>è¡¨ç¤ºä½¿ç”¨ä¸€ä¸ªactionï¼Œåä¸º<code>actions/checkout@v4</code>ï¼Œå®ƒç”¨æ¥æ‹‰å–ä»“åº“ã€‚</p>
<blockquote>
<p>åŒå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œé‡å¤çš„actionå¯ä»¥å°è£…èµ·æ¥ã€‚<a target="_blank" rel="noopener" href="https://github.com/marketplace?type=actions">actionå¸‚åœº</a>æä¾›äº†å¾ˆå¤šã€‚</p>
</blockquote>
<p><code>with</code>å±æ€§æŒ‡å®šäº†è¯¥actionçš„è¾“å…¥å‚æ•°ï¼Œæ¯ä¸ªactionçš„å‚æ•°ä¸å°½ç›¸åŒã€‚</p>
<p><code>ref</code>å‚æ•°è¡¨ç¤ºè¦æ‹‰å–çš„åˆ†æ”¯ï¼Œ<code>$&#123;&#123;github.head_ref&#125;&#125;</code>ä¹Ÿæ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œè¡¨ç¤ºå½“å‰prçš„æºåˆ†æ”¯ã€‚</p>
<h2 id="Get-Date-time"><a href="#Get-Date-time" class="headerlink" title="Get Date time"></a>Get Date time</h2><p>è¿™stepè¿˜å†™äº†<code>id</code>ï¼Œè¡¨ç¤ºè¯¥stepåœ¨è¯¥jobä¸­çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸ºä»€ä¹ˆè¦å†™å‘¢ï¼Ÿæ˜¯ä¸ºäº†ä¸‹ä¸€æ­¥stepèƒ½æ ¹æ®<code>id</code>è¯»å–åˆ°å®ƒçš„<code>output</code>ã€‚</p>
<blockquote>
<p><strong>output</strong>æ˜¯workflowä¸­éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒç”¨äºåœ¨stepä¹‹é—´ã€jobä¹‹é—´åˆ†äº«ç®€å•çš„æ•°æ®ã€‚</p>
</blockquote>
<p><code>run</code>å°±æ˜¯åœ¨å®¹å™¨ä¸­è·‘ä¸€ä¸ªå‘½ä»¤ï¼Œè¿™é‡Œè·‘äº†ä¸€ä¸ªunix bashå‘½ä»¤ï¼Œå°†å½“å‰æ—¶é—´å†™å…¥åˆ°<code>$GITHUB_OUTPUT</code>ä¸­ï¼Œé”®åä¸º<code>result</code>ã€‚</p>
<blockquote>
<p><code>$GITHUB_OUTPUT</code>æ˜¯workflowæ³¨å…¥åˆ°å®¹å™¨ä¸­çš„ä¸€ä¸ªè·¯å¾„ï¼Œç”¨äºå­˜æ”¾outputã€‚</p>
</blockquote>
<h2 id="Create-or-update-a-comment"><a href="#Create-or-update-a-comment" class="headerlink" title="Create or update a comment"></a>Create or update a comment</h2><p><code>uses</code>ä½¿ç”¨äº†æœ¬åœ°çš„actionï¼Œè¿™ä¸ªactionç”¨äºåˆ›å»ºæˆ–æ›´æ–°ä¸€ä¸ªå”¯ä¸€å›å¤ï¼Œä¸‹ä¸€èŠ‚è¯´ã€‚</p>
<blockquote>
<p>æœ‰æ—¶å€™ï¼Œå®˜æ–¹æˆ–å¸‚åœºçš„actionå¹¶ä¸èƒ½æ»¡è¶³ä½ çš„éœ€è¦ï¼Œå°±å¾—è‡ªå·±å†™ä¸€ä¸ªäº†ã€‚</p>
</blockquote>
<p>åŒç†ï¼Œè¯¥actionä¹Ÿæœ‰<code>with</code>å±æ€§ï¼Œ<code>uniqueIdentifier</code>æ˜¯å›å¤è¯„è®ºçš„å”¯ä¸€æ ‡è¯†ï¼Œ<code>body</code>æ˜¯å›å¤çš„å†…å®¹ï¼Œå†…å®¹ä½¿ç”¨äº†markdownè¯­æ³•ï¼Œé‡Œé¢è¿˜æ¶‰åŠåˆ°ä¸Šä¸‹æ–‡ä¸ä¸€ä¸€ç»†è®²äº†ã€‚åªè¯´<code>$&#123;&#123;steps.getDateTime.outputs.result&#125;&#125;</code>è¿™ä¸ªä¸Šä¸‹æ–‡è¡¨ç¤ºè·å–getDateTimeè¿™ä¸ªstepä¸­ï¼Œé”®åä¸º<code>result</code>çš„å€¼ã€‚</p>
<p>å¦‚æœä½ ä¸éœ€è¦åœ¨å†…å®¹é‡Œæ’å…¥æ—¶é—´ï¼Œé‚£ä¹ˆä¸Šé¢çš„<code>Get Date time</code>å°±å¯ä»¥çœç•¥äº†ã€‚</p>
<h2 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>å› ä¸ºæˆ‘å·²ç»æœ‰å®Œæ•´çš„ä»£ç äº†ï¼Œæ‰€ä»¥è¿è¡Œåï¼Œprä¸­ä¼šæœ‰ä¸€ä¸ªå›å¤ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://github.com/taoliujun/blog/assets/5689134/42396a84-b798-4f4e-9f39-5bf92a8acb15"></p>
<!--hexo-->

<h1 id="x2F-github-x2F-actions-x2F-unique-comment"><a href="#x2F-github-x2F-actions-x2F-unique-comment" class="headerlink" title=".&#x2F;.github&#x2F;actions&#x2F;unique-comment"></a>.&#x2F;.github&#x2F;actions&#x2F;unique-comment</h1><p>è¿™æ˜¯ä¸€ä¸ªå°è£…çš„javascript actionï¼Œç”¨äºå¯¹issueåˆ›å»ºã€æ›´æ–°å”¯ä¸€è¯„è®ºã€‚</p>
<h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>åˆ›å»ºç›®å½•<code>./.github/actions/unique-comment</code>ï¼Œæœ€ç»ˆç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ action.yml</span><br><span class="line">â”œâ”€â”€ config</span><br><span class="line">â”‚Â Â  â””â”€â”€ webpack.config.js</span><br><span class="line">â”œâ”€â”€ dist</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">â”‚Â Â  â””â”€â”€ index.js.LICENSE.txt</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â””â”€â”€ index.js</span><br></pre></td></tr></table></figure>

<h2 id="action-yml"><a href="#action-yml" class="headerlink" title="action.yml"></a>action.yml</h2><p>è¿™æ˜¯actionçš„é…ç½®æ–‡ä»¶ï¼Œå¿…é¡»å­˜åœ¨ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">unique-comment</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">create</span> <span class="string">or</span> <span class="string">update</span> <span class="string">a</span> <span class="string">unique</span> <span class="string">comment</span></span><br><span class="line"></span><br><span class="line"><span class="attr">runs:</span></span><br><span class="line">    <span class="attr">using:</span> <span class="string">&#x27;node20&#x27;</span></span><br><span class="line">    <span class="attr">main:</span> <span class="string">&#x27;./dist/index.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">inputs:</span></span><br><span class="line">    <span class="attr">token:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;GitHub token&#x27;</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">default:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.token</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">owner:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Repository owner&#x27;</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">default:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event.repository.owner.login</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">repo:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Repository name&#x27;</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">default:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event.repository.name</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">issue_number:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Issue number&#x27;</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">default:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event.number</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">body:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Comment body&#x27;</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">uniqueIdentifier:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Unique identifier for comment&#x27;</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">default:</span> <span class="string">&#x27;unique-comment&#x27;</span></span><br></pre></td></tr></table></figure>

<p>å¤§éƒ¨åˆ†å±æ€§ä¸ä¸€ä¸€ç»†è®²äº†ï¼Œéƒ½æ˜¯ç®€å•çš„è‹±æ–‡æœ›æ–‡ç”Ÿä¹‰å³å¯ã€‚</p>
<p><code>runs</code>è¡¨ç¤ºè¿è¡Œåœ¨<code>node20</code>ç¯å¢ƒä¸‹ï¼Œå…¥å£æ–‡ä»¶ä¸º<code>./dist/index.js</code>ã€‚</p>
<p><code>inputs</code>è¡¨ç¤ºæ¥å—çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰æåˆ°çš„<code>with</code>å±æ€§é‡Œè¦è¾“å…¥çš„å‚æ•°ã€‚ç”¨<code>required</code>è¡¨ç¤ºæ˜¯å¦å¿…é¡»ä¼ å…¥ï¼Œ<code>default</code>è¡¨ç¤ºé»˜è®¤å€¼ã€‚</p>
<h2 id="src-x2F-index-js"><a href="#src-x2F-index-js" class="headerlink" title="src&#x2F;index.js"></a>src&#x2F;index.js</h2><p>ä¸ºä»€ä¹ˆå…¥å£æ–‡ä»¶æ˜¯<code>dist/index.js</code>ï¼Œè€Œä¸æ˜¯<code>src/index.js</code>å‘¢ï¼Ÿå› ä¸ºè¦å¼•ç”¨ä¸€äº›githubå®˜æ–¹æä¾›çš„å¿«æ·æ“ä½œgithub REST APIçš„jsåŒ…å»æ“ä½œissueè¯„è®º(pull requestä¹Ÿæ˜¯ä¸€ç§issue)ï¼Œæœ€ç»ˆæ‰“åŒ…åçš„æ–‡ä»¶æ‰èƒ½åœ¨å·¥ä½œæµä¸­ç¨³å¦¥çš„è¿è¡Œã€‚æ‰€ä»¥ï¼Œå†™å¥½<code>src/index.js</code>ï¼Œå†æ‰“åŒ…å°±è¡Œã€‚</p>
<p>è¯¥æ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> core = <span class="built_in">require</span>(<span class="string">&#x27;@actions/core&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> github = <span class="built_in">require</span>(<span class="string">&#x27;@actions/github&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">main</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> token = core.<span class="title function_">getInput</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> owner = core.<span class="title function_">getInput</span>(<span class="string">&#x27;owner&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> repo = core.<span class="title function_">getInput</span>(<span class="string">&#x27;repo&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> issueNumber = core.<span class="title function_">getInput</span>(<span class="string">&#x27;issue_number&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> uniqueIdentifier = <span class="string">`[^uniqueIdentifier]: <span class="subst">$&#123;core.getInput(<span class="string">&#x27;uniqueIdentifier&#x27;</span>)&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">const</span> body = <span class="string">`<span class="subst">$&#123;core.getInput(<span class="string">&#x27;body&#x27;</span>)&#125;</span>\n\n<span class="subst">$&#123;uniqueIdentifier&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    core.<span class="title function_">debug</span>(<span class="string">`uniqueIdentifier is <span class="subst">$&#123;uniqueIdentifier&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> octokit = github.<span class="title function_">getOctokit</span>(token);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> comments = <span class="keyword">await</span> octokit.<span class="property">rest</span>.<span class="property">issues</span>.<span class="title function_">listComments</span>(&#123;</span><br><span class="line">        owner,</span><br><span class="line">        repo,</span><br><span class="line">        <span class="attr">issue_number</span>: issueNumber,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> botComment = comments.<span class="property">data</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v.<span class="property">body</span>.<span class="title function_">includes</span>(uniqueIdentifier));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (botComment) &#123;</span><br><span class="line">        core.<span class="title function_">info</span>(<span class="string">&#x27;update comment successfully.&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> octokit.<span class="property">rest</span>.<span class="property">issues</span>.<span class="title function_">updateComment</span>(&#123;</span><br><span class="line">            owner,</span><br><span class="line">            repo,</span><br><span class="line">            <span class="attr">comment_id</span>: botComment.<span class="property">id</span>,</span><br><span class="line">            body,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        core.<span class="title function_">info</span>(<span class="string">&#x27;create comment successfully.&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> octokit.<span class="property">rest</span>.<span class="property">issues</span>.<span class="title function_">createComment</span>(&#123;</span><br><span class="line">            owner,</span><br><span class="line">            repo,</span><br><span class="line">            <span class="attr">issue_number</span>: issueNumber,</span><br><span class="line">            body,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title function_">main</span>();</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    core.<span class="title function_">setFailed</span>(err.<span class="property">message</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@actions/core</code>å’Œ<code>@actions/github</code>æ˜¯githubå®˜æ–¹æä¾›çš„jsåŒ…ï¼Œå‰è€…å¯ä»¥æ–¹ä¾¿çš„è¯»å–å…¥å‚ç­‰ï¼Œåè€…å¯ä»¥æ–¹ä¾¿çš„æ“ä½œgithub REST APIã€‚</p>
<p><code>main</code>å‡½æ•°çš„ä»£ç å°±æ˜¯åŸç”Ÿjavascriptï¼Œä¸ä¸€ä¸€è§£é‡Šäº†ï¼Œä¸»è¦é€šè¿‡<code>uniqueIdentifier</code>æ¥åˆ¤æ–­æ˜¯å¦å‘å¸ƒè¿‡è¯„è®ºï¼Œå¦‚æœæ˜¯ï¼Œå°±æ›´æ–°è¯„è®ºï¼Œå¦åˆ™å°±åˆ›å»ºè¯„è®ºã€‚</p>
<blockquote>
<p>markdownè¯­æ³•<code>[^uniqueIdentifier]</code>è¡¨ç¤ºè„šæ³¨ï¼Œä¸ä¼šè¢«æ¸²æŸ“ã€‚</p>
</blockquote>
<p><code>core.setFailed(err.message);</code>è¡¨ç¤ºæŠ›å‡ºé€€å‡ºä»£ç ã€‚</p>
<h2 id="config-x2F-webpack-config-js"><a href="#config-x2F-webpack-config-js" class="headerlink" title="config&#x2F;webpack.config.js"></a>config&#x2F;webpack.config.js</h2><p>æ‰“åŒ…ç”¨çš„ï¼Œé…ç½®ç®€å•å¯ç”¨å³å¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    <span class="attr">target</span>: <span class="string">&#x27;node20&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;index.js&#x27;</span>,</span><br><span class="line">        <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;unique-comment&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;private&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --config ./config/webpack.config.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@actions/core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.10.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@actions/github&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;webpack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.89.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;webpack-cli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.1.4&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>æ²¡å•¥å¥½è¯´çš„ï¼Œåˆ—å‡ºäº†ä¾èµ–é¡¹ã€‚å’Œä¸€ä¸ªæ‰“åŒ…è„šæœ¬ã€‚</p>
<h2 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ä¿®æ”¹äº†<code>src/index.js</code>å¾—<code>build</code>ï¼Œç„¶åpushåˆ°githubä»“åº“ã€‚</p>
<p>è®°å¾—å°†<strong>dist</strong>ç›®å½•ä¹Ÿæäº¤åˆ°githubä»“åº“ã€‚</p>
<!--hexo-->

<h1 id="init"><a href="#init" class="headerlink" title="init"></a>init</h1><p>ç°åœ¨ï¼Œå¼€å§‹ææ­£ç»çš„äº†ã€‚</p>
<p>å…ˆåˆå§‹åŒ–é¡¹ç›®ï¼Œè¿™ä¸ªjobçš„ç›®çš„ä»…ä»…æ˜¯ä¸ºäº†ç¼“å­˜pnpmä¾èµ–é¡¹ï¼Œå¦‚æœä½ çš„é¡¹ç›®çš„ä¾èµ–é¡¹ä¸ç»å¸¸æ›´æ–°ï¼Œå¯ä»¥çœç•¥è¿™ä¸ªjobï¼Œåç»­ä¹Ÿä¸è¦<code>needs</code>è¿™ä¸ªjobã€‚</p>
<p>å°†initæ”¹æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">init:</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">repo</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">ref:</span> <span class="string">$&#123;&#123;github.head_ref&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">pnpm</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">pnpm/action-setup@v2</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">version:</span> <span class="number">8</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">node</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/setup-node@v4</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">node-version:</span> <span class="number">20</span></span><br><span class="line">                  <span class="attr">cache:</span> <span class="string">&#x27;pnpm&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">              <span class="attr">run:</span> <span class="string">pnpm</span> <span class="string">install</span></span><br></pre></td></tr></table></figure>

<p>ç›¸ä¿¡ç»è¿‡å¯¹ä¹‹å‰çš„jobçš„äº†è§£ï¼Œè¿™é‡Œçš„é…ç½®å°±çœ‹èµ·æ¥å¾ˆç®€å•äº†ã€‚</p>
<h2 id="Init-pnpm"><a href="#Init-pnpm" class="headerlink" title="Init pnpm"></a>Init pnpm</h2><p>ä½¿ç”¨ç¬¬ä¸‰æ–¹actionï¼Œå®‰è£…pnpm@^8ã€‚</p>
<h2 id="Init-node"><a href="#Init-node" class="headerlink" title="Init node"></a>Init node</h2><p><code>cache: &#39;pnpm&#39;</code>æŒ‡å®šç¼“å­˜æœºåˆ¶ï¼Œå®ƒå†…éƒ¨æ˜¯åˆ©ç”¨äº†workflowçš„cacheæœºåˆ¶ã€‚</p>
<h2 id="Install-dependencies"><a href="#Install-dependencies" class="headerlink" title="Install dependencies"></a>Install dependencies</h2><p>å®‰è£…ä¾èµ–é¡¹ï¼Œè§¦å‘ç¼“å­˜ã€‚</p>
<!--hexo-->

<h1 id="eslint"><a href="#eslint" class="headerlink" title="eslint"></a>eslint</h1><p>å°†eslintæ”¹æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eslint:</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">needs:</span> [<span class="string">init</span>]</span><br><span class="line">        <span class="attr">outputs:</span></span><br><span class="line">            <span class="attr">result:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.lint.outputs.result</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">repo</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">ref:</span> <span class="string">$&#123;&#123;github.head_ref&#125;&#125;</span></span><br><span class="line">                  <span class="attr">fetch-depth:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">pnpm</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">pnpm/action-setup@v2</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">version:</span> <span class="number">8</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">node</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/setup-node@v4</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">node-version:</span> <span class="number">20</span></span><br><span class="line">                  <span class="attr">cache:</span> <span class="string">&#x27;pnpm&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">              <span class="attr">run:</span> <span class="string">pnpm</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">eslint</span></span><br><span class="line">              <span class="attr">id:</span> <span class="string">lint</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/github-script@v7</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">result-encoding:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">script:</span> <span class="string">|</span></span><br><span class="line"><span class="string">                      let output = &#x27;&#x27;;</span></span><br><span class="line"><span class="string">                      let outerr = &#x27;&#x27;;</span></span><br><span class="line"><span class="string">                      let diffFiles = &#x27;&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">                      <span class="string">await</span> <span class="string">exec.exec(</span></span><br><span class="line">                        <span class="string">`git</span> <span class="string">diff</span> <span class="string">--name-only</span> <span class="string">origin/$&#123;&#123;github.base_ref&#125;&#125;`,</span></span><br><span class="line">                        []<span class="string">,</span></span><br><span class="line">                        &#123;</span><br><span class="line">                          <span class="string">//</span> <span class="attr">silent:</span> <span class="literal">true</span>,</span><br><span class="line">                          <span class="string">//</span> <span class="attr">ignoreReturnCode:</span> <span class="literal">true</span>,</span><br><span class="line">                          <span class="attr">listeners:</span> &#123;</span><br><span class="line">                            <span class="attr">stdout:</span> <span class="string">(data)</span> <span class="string">=&gt;</span> &#123;</span><br><span class="line">                                <span class="string">diffFiles</span> <span class="string">+=</span> <span class="string">data.toString();</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                          &#125;,</span><br><span class="line">                        &#125;</span><br><span class="line">                      <span class="string">);</span></span><br><span class="line"></span><br><span class="line">                      <span class="string">const</span> <span class="string">lintFiles</span> <span class="string">=</span> <span class="string">diffFiles.split(`\n`).filter((file)</span> <span class="string">=&gt;</span> &#123;</span><br><span class="line">                        <span class="string">return</span> <span class="string">file.endsWith(&#x27;.js&#x27;)</span> <span class="string">||</span> <span class="string">file.endsWith(&#x27;.ts&#x27;)</span> <span class="string">||</span> <span class="string">file.endsWith(&#x27;.tsx&#x27;)</span></span><br><span class="line">                      &#125;<span class="string">).join(&#x27;</span> <span class="string">&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                      await exec.exec(</span></span><br><span class="line"><span class="string">                        // &quot;pnpm run lint --format stylish&quot;,</span></span><br><span class="line"><span class="string">                        `pnpm eslint $&#123;lintFiles&#125;`,</span></span><br><span class="line"><span class="string">                        [],</span></span><br><span class="line"><span class="string">                        &#123;</span></span><br><span class="line"><span class="string">                          // silent: true,</span></span><br><span class="line"><span class="string">                          ignoreReturnCode: true,</span></span><br><span class="line"><span class="string">                          listeners: &#123;</span></span><br><span class="line"><span class="string">                            stdout: (data) =&gt; &#123;</span></span><br><span class="line"><span class="string">                                output += data.toString();</span></span><br><span class="line"><span class="string">                            &#125;,</span></span><br><span class="line"><span class="string">                            stderr: (data) =&gt; &#123;</span></span><br><span class="line"><span class="string">                                outerr += data.toString();</span></span><br><span class="line"><span class="string">                            &#125;,</span></span><br><span class="line"><span class="string">                          &#125;,</span></span><br><span class="line"><span class="string">                        &#125;</span></span><br><span class="line"><span class="string">                      );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                      if (outerr) &#123;</span></span><br><span class="line"><span class="string">                        return `:x: Some command execution errors, non-eslint business errors.`;</span></span><br><span class="line"><span class="string">                      &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                      const errorMatch = output.match(/(\d+) errors?/);</span></span><br><span class="line"><span class="string">                      const warnMatch = output.match(/(\d+) warnings?/);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                      if (errorMatch &amp;&amp; errorMatch?.[1] !== &#x27;</span><span class="number">0</span><span class="string">&#x27;) &#123;</span></span><br><span class="line"><span class="string">                        return `:x: $&#123;errorMatch?.[0]&#125; $&#123;warnMatch?.[0]&#125;`;</span></span><br><span class="line"><span class="string">                      &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                      return `:white_check_mark: $&#123;errorMatch?.[0] || &#x27;</span><span class="number">0</span> <span class="string">error&#x27;&#125;</span> <span class="string">$&#123;warnMatch?.[0]</span> <span class="string">||</span> <span class="string">&#x27;0 warning&#x27;</span><span class="string">&#125;`;</span></span><br></pre></td></tr></table></figure>

<h2 id="needs"><a href="#needs" class="headerlink" title="needs"></a>needs</h2><p>ä½¿ç”¨<code>needs</code>ä¾èµ–initï¼Œå¯ä»¥ä½¿ç”¨åˆ°pnpmçš„ç¼“å­˜é¡¹ï¼Œé˜²æ­¢installå¤ªæ…¢ã€‚</p>
<blockquote>
<p>å› ä¸ºeslintã€typescriptã€unitTestéƒ½éœ€è¦pnpm installï¼Œæ‰€ä»¥ä¸€ä¸ªå‰ç½®çš„initå»ç¼“å­˜pnpmä¾èµ–é¡¹ï¼Œå¯ä»¥åŠ å¿«åç»­çš„installé€Ÿåº¦ã€‚</p>
</blockquote>
<h2 id="outputs"><a href="#outputs" class="headerlink" title="outputs"></a>outputs</h2><p>jobé‡Œçš„outputsï¼Œå¯ä»¥åœ¨ä¾èµ–å®ƒçš„å…¶ä»–jobä¸­è®¿é—®åˆ°ã€‚è¿™é‡Œä½¿ç”¨<code>$&#123;&#123; steps.lint.outputs.result &#125;&#125;</code>å»è·å–è¯¥jobä¸­lintè¿™ä¸ªstepé‡Œçš„outputé‡Œçš„resultã€‚</p>
<blockquote>
<p>outputæœ‰jobå’Œstepä¸¤ä¸ªç»´åº¦ï¼Œæ³¨æ„åŒºåˆ†ã€‚</p>
</blockquote>
<h2 id="Run-eslint"><a href="#Run-eslint" class="headerlink" title="Run eslint"></a>Run eslint</h2><p>å®ƒusesäº†<code>actions/github-script@v7</code>ï¼Œè¿™æ˜¯githubå®˜æ–¹æä¾›çš„ä¸€ä¸ªactionï¼Œå¯ä»¥åœ¨<code>with.script</code>é‡Œå†™jsä»£ç å»æ‰§è¡Œï¼ŒåŒæ—¶å®ƒä¼šæ³¨å…¥ä¸€äº›å˜é‡åˆ°scriptä¸­å»ï¼Œè§å®ƒçš„<a target="_blank" rel="noopener" href="https://github.com/actions/github-script/tree/v7/">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<blockquote>
<p>å¯¹äºç®€å•çš„jsä»£ç ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªactionå»å®Œæˆï¼Œä¸ç”¨å†å»å†™ä¸€ä¸ªjsæ–‡ä»¶ã€‚</p>
</blockquote>
<p><code>result-encoding</code>æ˜¯æŒ‡å®šscriptè¿”å›çš„æ•°æ®æ ¼å¼çš„ï¼Œé»˜è®¤æ˜¯jsonï¼Œè¿™æŒ‡å®šä¸ºstringã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆscripté‡Œreturnäº†stringï¼Œè¿˜è¦æŒ‡å®šä¸ºstringå‘¢ï¼Ÿ<br>å› ä¸º<code>return &#39;hello&#39;</code>åœ¨json encodeåæ˜¯<code>&#39;&quot;hello&quot;&#39;</code>ï¼Œè€Œstring encodeåä¸º<code>&#39;hello&#39;</code>ã€‚</p>
</blockquote>
<p>scripté‡Œæ˜¯åŸç”Ÿçš„jsä»£ç äº†ï¼Œé‡Œé¢çš„<code>exec</code>æ˜¯è¯¥actionæ³¨å…¥çš„å˜é‡ï¼Œç”¨æ¥æ‰§è¡Œshellå‘½ä»¤ã€‚</p>
<p>è¿™æ®µjsä»£ç åšäº†ä¸¤ä¸ªäº‹æƒ…ï¼Œä¸€æ˜¯<code>git diff</code>è·å–prä¸­æ”¹åŠ¨çš„æ–‡ä»¶åˆ—è¡¨ï¼ŒäºŒæ˜¯<code>eslint</code>æ£€æŸ¥è¿™äº›å¢é‡æ–‡ä»¶ï¼Œæœ€åè¿”å›å¤„ç†çš„ç»“æœã€‚</p>
<h2 id="fetch-depth"><a href="#fetch-depth" class="headerlink" title="fetch-depth"></a>fetch-depth</h2><p>Init repoè¿™ä¸ªstepé‡Œè®¾ç½®äº†<code>fetch-depth: 0</code>ï¼Œä¸ç„¶è·å–ä¸åˆ°å®Œæ•´çš„gitåˆ†æ”¯ï¼Œå…·ä½“çœ‹<code>actions/checkout</code>çš„è§£é‡Šï¼Œæ¶‰åŠåˆ°gitçš„çŸ¥è¯†ä¸å±•å¼€ç»†è¯´äº†ã€‚</p>
<h2 id="steps-lint-outputs-result"><a href="#steps-lint-outputs-result" class="headerlink" title="steps.lint.outputs.result"></a>steps.lint.outputs.result</h2><p><code>steps.lint.outputs.result</code>ä¸ºä»€ä¹ˆèƒ½æ‹¿åˆ°lint stepé‡Œçš„output.resultå‘¢ï¼Ÿå› ä¸º<code>actions/github-script</code>è¿™ä¸ªactionå†…éƒ¨å°†scriptçš„è¿”å›å€¼ï¼Œè®¾ç½®åˆ°<code>$GITHUB_OUTPUT</code>é‡Œäº†ï¼Œä¸”é”®åä¸º<code>result</code>ã€‚</p>
<!--hexo-->

<h1 id="typescript"><a href="#typescript" class="headerlink" title="typescript"></a>typescript</h1><p>å’Œeslintçš„é…ç½®å¤§åŒå°å¼‚ï¼Œåªæ˜¯æ”¹äº†å¯¹æ£€æµ‹ç»“æœçš„åˆ¤æ–­ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">typescript:</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">needs:</span> [<span class="string">init</span>]</span><br><span class="line">        <span class="attr">outputs:</span></span><br><span class="line">            <span class="attr">result:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.lint.outputs.result</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">repo</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">ref:</span> <span class="string">$&#123;&#123;github.head_ref&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">pnpm</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">pnpm/action-setup@v2</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">version:</span> <span class="number">8</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">node</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/setup-node@v4</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">node-version:</span> <span class="number">20</span></span><br><span class="line">                  <span class="attr">cache:</span> <span class="string">&#x27;pnpm&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">              <span class="attr">run:</span> <span class="string">pnpm</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">lint</span></span><br><span class="line">              <span class="attr">id:</span> <span class="string">lint</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/github-script@v7</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">result-encoding:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">script:</span> <span class="string">|</span></span><br><span class="line"><span class="string">                      let output = &#x27;&#x27;;</span></span><br><span class="line"><span class="string">                      let outerr = &#x27;&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">                      <span class="string">await</span> <span class="string">exec.exec(</span></span><br><span class="line">                        <span class="string">`pnpm</span> <span class="string">run</span> <span class="string">-r</span> <span class="string">lint:ts`,</span></span><br><span class="line">                        []<span class="string">,</span></span><br><span class="line">                        &#123;</span><br><span class="line">                          <span class="string">//</span> <span class="attr">silent:</span> <span class="literal">true</span>,</span><br><span class="line">                          <span class="attr">ignoreReturnCode:</span> <span class="literal">true</span>,</span><br><span class="line">                          <span class="attr">listeners:</span> &#123;</span><br><span class="line">                            <span class="attr">stdout:</span> <span class="string">(data)</span> <span class="string">=&gt;</span> &#123;</span><br><span class="line">                                <span class="string">output</span> <span class="string">+=</span> <span class="string">data.toString();</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">stderr:</span> <span class="string">(data)</span> <span class="string">=&gt;</span> &#123;</span><br><span class="line">                                <span class="string">outerr</span> <span class="string">+=</span> <span class="string">data.toString();</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                          &#125;,</span><br><span class="line">                        &#125;</span><br><span class="line">                      <span class="string">);</span></span><br><span class="line"></span><br><span class="line">                      <span class="string">if</span> <span class="string">(outerr)</span> &#123;</span><br><span class="line">                        <span class="string">return</span> <span class="string">`:x:</span> <span class="string">Some</span> <span class="string">command</span> <span class="string">execution</span> <span class="string">errors</span>, <span class="literal">no</span> <span class="string">business</span> <span class="string">errors.`;</span></span><br><span class="line">                      &#125;</span><br><span class="line"></span><br><span class="line">                      <span class="string">const</span> <span class="string">errorMatch</span> <span class="string">=</span> <span class="string">output.match(/error</span> <span class="string">TS/g);</span></span><br><span class="line"></span><br><span class="line">                      <span class="string">if</span> <span class="string">(errorMatch)</span> &#123;</span><br><span class="line">                        <span class="string">return</span> <span class="string">`:x:</span> <span class="string">$</span>&#123;<span class="string">errorMatch?.length</span>&#125; <span class="string">errors`;</span></span><br><span class="line">                      &#125;</span><br><span class="line"></span><br><span class="line">                      <span class="string">return</span> <span class="string">`:white_check_mark:</span> <span class="string">$&#123;&#x27;0</span> <span class="string">error&#x27;&#125;`;</span></span><br></pre></td></tr></table></figure>
<!--hexo-->

<h1 id="unitTest"><a href="#unitTest" class="headerlink" title="unitTest"></a>unitTest</h1><p>å’Œeslintçš„é…ç½®å¤§åŒå°å¼‚ï¼Œåªæ˜¯æ”¹äº†å¯¹æ£€æµ‹ç»“æœçš„åˆ¤æ–­ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯jestçš„æ£€æµ‹ç»“æœæ˜¯è¾“å‡ºåˆ°stderrï¼Œè§<a target="_blank" rel="noopener" href="https://github.com/jestjs/jest/issues/5064%E3%80%82">https://github.com/jestjs/jest/issues/5064ã€‚</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">unitTest:</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">needs:</span> [<span class="string">init</span>]</span><br><span class="line">        <span class="attr">outputs:</span></span><br><span class="line">            <span class="attr">result:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.lint.outputs.result</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">repo</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">ref:</span> <span class="string">$&#123;&#123;github.head_ref&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">pnpm</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">pnpm/action-setup@v2</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">version:</span> <span class="number">8</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">node</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/setup-node@v4</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">node-version:</span> <span class="number">20</span></span><br><span class="line">                  <span class="attr">cache:</span> <span class="string">&#x27;pnpm&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">              <span class="attr">run:</span> <span class="string">pnpm</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">lint</span></span><br><span class="line">              <span class="attr">id:</span> <span class="string">lint</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/github-script@v7</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">result-encoding:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">script:</span> <span class="string">|</span></span><br><span class="line"><span class="string">                      let output = &#x27;&#x27;;</span></span><br><span class="line"><span class="string">                      let outerr = &#x27;&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">                      <span class="string">await</span> <span class="string">exec.exec(</span></span><br><span class="line">                        <span class="string">`pnpm</span> <span class="string">run</span> <span class="string">test`,</span></span><br><span class="line">                        []<span class="string">,</span></span><br><span class="line">                        &#123;</span><br><span class="line">                          <span class="string">//</span> <span class="attr">silent:</span> <span class="literal">true</span>,</span><br><span class="line">                          <span class="attr">ignoreReturnCode:</span> <span class="literal">true</span>,</span><br><span class="line">                          <span class="attr">listeners:</span> &#123;</span><br><span class="line">                            <span class="attr">stdout:</span> <span class="string">(data)</span> <span class="string">=&gt;</span> &#123;</span><br><span class="line">                                <span class="string">output</span> <span class="string">+=</span> <span class="string">data.toString();</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">stderr:</span> <span class="string">(data)</span> <span class="string">=&gt;</span> &#123;</span><br><span class="line">                                <span class="string">outerr</span> <span class="string">+=</span> <span class="string">data.toString();</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                          &#125;,</span><br><span class="line">                        &#125;</span><br><span class="line">                      <span class="string">);</span></span><br><span class="line"></span><br><span class="line">                      <span class="string">//</span> <span class="string">why</span> <span class="string">use</span> <span class="string">outerr?</span> <span class="string">https://github.com/jestjs/jest/issues/5064</span></span><br><span class="line"></span><br><span class="line">                      <span class="string">const</span> <span class="string">failMatch</span> <span class="string">=</span> <span class="string">outerr.match(/Test</span> <span class="attr">Suites:</span> <span class="string">\d+</span> <span class="string">failed/);</span></span><br><span class="line"></span><br><span class="line">                      <span class="string">if</span> <span class="string">(failMatch)</span> &#123;</span><br><span class="line">                        <span class="string">return</span> <span class="string">`:x:</span> <span class="string">$</span>&#123;<span class="string">failMatch?.</span>[<span class="number">0</span>]&#125;<span class="string">`;</span></span><br><span class="line">                      &#125;</span><br><span class="line"></span><br><span class="line">                      <span class="string">const</span> <span class="string">errorMatch</span> <span class="string">=</span> <span class="string">outerr.match(/Jest:</span> <span class="string">&quot;global&quot;</span> <span class="string">coverage</span> <span class="string">threshold</span> <span class="string">for</span> <span class="string">lines</span> <span class="string">\([0-9\.]+%\)</span> <span class="attr">not met:</span> [<span class="number">0</span><span class="number">-9</span><span class="string">\.</span>]<span class="string">+%/);</span></span><br><span class="line"></span><br><span class="line">                      <span class="string">if</span> <span class="string">(errorMatch)</span> &#123;</span><br><span class="line">                        <span class="string">return</span> <span class="string">`:x:</span> <span class="string">$</span>&#123;<span class="string">errorMatch?.</span>[<span class="number">0</span>]&#125;<span class="string">`;</span></span><br><span class="line">                      &#125;</span><br><span class="line"></span><br><span class="line">                      <span class="string">return</span> <span class="string">`:white_check_mark:</span> <span class="string">passed`;</span></span><br></pre></td></tr></table></figure>
<!--hexo-->

<h1 id="replyResult"><a href="#replyResult" class="headerlink" title="replyResult"></a>replyResult</h1><p>æœ€åï¼Œå°†å‡ ä¸ªæ£€æµ‹çš„ç»“æœè¿›è¡Œæ±‡æ€»ï¼Œå›å¤åˆ°pré‡Œå°±è¡Œäº†ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">replyResult:</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">needs:</span> [<span class="string">replyChecking</span>, <span class="string">eslint</span>, <span class="string">typescript</span>, <span class="string">unitTest</span>]</span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">ref:</span> <span class="string">$&#123;&#123;github.head_ref&#125;&#125;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">date</span> <span class="string">time</span></span><br><span class="line">              <span class="attr">id:</span> <span class="string">getDateTime</span></span><br><span class="line">              <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;result=$(TZ=Asia/Shanghai date)&quot;</span> <span class="string">&gt;&gt;</span> <span class="string">&quot;$GITHUB_OUTPUT&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">or</span> <span class="string">update</span> <span class="string">a</span> <span class="string">comment</span></span><br><span class="line">              <span class="attr">uses:</span> <span class="string">./.github/actions/unique-comment</span></span><br><span class="line">              <span class="attr">with:</span></span><br><span class="line">                  <span class="attr">uniqueIdentifier:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.workflow</span> <span class="string">&#125;&#125;</span></span><br><span class="line">                  <span class="attr">body:</span> <span class="string">|</span></span><br><span class="line"><span class="string">                      ## Eslint Check Result</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">                      <span class="string">$&#123;&#123;needs.eslint.outputs.result&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">                      <span class="comment">## Typescript Check Result</span></span><br><span class="line"></span><br><span class="line">                      <span class="string">$&#123;&#123;needs.typescript.outputs.result&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">                      <span class="comment">## UnitTest Check Result</span></span><br><span class="line"></span><br><span class="line">                      <span class="string">$&#123;&#123;needs.unitTest.outputs.result&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">                      <span class="string">---</span></span><br><span class="line"></span><br><span class="line">                      <span class="string">Commented</span> <span class="string">by</span> <span class="string">Action</span> [<span class="string">$<span class="template-variable">&#123;&#123;github.workflow&#125;&#125;</span></span>]<span class="string">($&#123;&#123;github.event.repository.html_url&#125;&#125;/actions/runs/$&#123;&#123;github.run_id&#125;&#125;),</span> <span class="string">last</span> <span class="string">updated</span> <span class="string">on</span> <span class="string">$&#123;&#123;steps.getDateTime.outputs.result&#125;&#125;.</span></span><br></pre></td></tr></table></figure>

<p>å’ŒreplyCheckingå·®ä¸å¤šï¼Œåœ¨bodyé‡Œä½¿ç”¨<code>$&#123;&#123;needs.eslint.outputs.result&#125;&#125;</code>å»è¯»å–äº†eslint jobçš„outputsã€‚</p>
<h2 id="æµ‹è¯•-3"><a href="#æµ‹è¯•-3" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>å»å‘èµ·æ–°çš„prï¼Œæ•…æ„æäº¤ä¸€ä¸ªæœ‰eslint errorçš„js&#x2F;tsæ–‡ä»¶ï¼Œçœ‹çœ‹è¡¨ç°å§~</p>

    </div>
  </div>
  
  
  

  

  <div class="article-footer">
    <div class="article-meta pull-left">
      <span>
        
          <i class="iconfont icon-06tags"></i>æ ‡ç­¾: 
          
          <span class="span--tag">
            <a href="/blog/tags/github-actions/">
              #github actions
            </a>
          </span>
          
        
      </span>
    </div>
    <div class="article-meta pull-right">
    </div>
  </div>
</div>


  <aside id="sidebar">
    <p id="sidebar-header"></p>
    <ol id="sidebar-toc"></ol>
  </aside>
  <script async>setTimeout(generateToc, 10);</script>


  <nav class="post-navigation">
    
      <div class="nav-pre">
        <i class="iconfont icon-prev"></i>
        ä¸Šä¸€ç¯‡:
        <a href="/blog/react-zustand/" target="_self">Reactå…¬å…±çŠ¶æ€åˆ©å™¨ - Zustand</a>
      </div>
    
    
      <div class="nav-next">
        ä¸‹ä¸€ç¯‡:
        <a href="/blog/snapshot-impact-on-coverage/" target="_self">snapshotå¯¹å•æµ‹è¦†ç›–ç‡çš„å½±å“ä»¥åŠåº”å¯¹æ–¹æ¡ˆ</a>
        <i class="iconfont icon-next"></i>
      </div>
    
  </nav>

   

   

</div>


      <footer>
  <p class="site-info">
    Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> | Theme - <a target="_blank" rel="noopener" href="https://github.com/dongyuanxin/theme-bmw">BMW</a>
    <br>
    
  </p>
</footer>

      <div class="back-to-top hidden">
  <span>
    <i class="iconfont icon-60"></i><span></span>%
  </span>
</div>

<script>
const updateIconToTop = percent => {
  let dom = document.querySelector(".back-to-top span span");
  dom.innerText = percent;
  if(percent < 1) {
    document.querySelector(".back-to-top").className = "back-to-top hidden";
  } else {
    document.querySelector(".back-to-top").className = "back-to-top";
  }
}

const handleScoll = () => {
  let isRunning = false;
  return () => {
    if (isRunning) return;
    isRunning = true;
    window.requestAnimationFrame(timestamp => {
      let scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop,
        scrollHeight =
          document.documentElement.scrollHeight ||
          document.body.scrollHeight,
        clientHeight =
          document.documentElement.clientHeight ||
          document.body.clientHeight;
      isRunning = false;
      if (scrollTop <= 1) {
        updateIconToTop(0);
        return;
      }
      if (scrollTop + clientHeight >= scrollHeight) {
        updateIconToTop(100);
      } else {
        updateIconToTop(parseInt(
          100 * scrollTop / (scrollHeight - clientHeight),
          10
        ));
      }
    });
  };
}

const backToTop = () => {
  let scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop,
    delay = 10,
    time = 200;
  if (scrollTop <= 20) {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    return;
  }
  let step = Math.ceil(scrollTop * delay / time);
  let timer = setInterval(() => {
    scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop;
    if (scrollTop - step <= 0) {
      document.documentElement.scrollTop = 0;
      document.body.scrollTop = 0;
      clearInterval(timer);
    } else {
      document.documentElement.scrollTop = scrollTop - step;
      document.body.scrollTop = scrollTop - step;
    }
  }, delay);
}

document.addEventListener("scroll", handleScoll(), false);

document.querySelector(".back-to-top").addEventListener("click", backToTop, false);

</script>

    </div>

    
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  (() => {
    const mathjaxConfig = {
      showProcessingMessages: false, //å…³é—­jsåŠ è½½è¿‡ç¨‹ä¿¡æ¯
      messageStyle: "none", //ä¸æ˜¾ç¤ºä¿¡æ¯
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]], //è¡Œå†…å…¬å¼é€‰æ‹©ç¬¦
        displayMath: [["$$", "$$"], ["\\[", "\\]"]], //æ®µå†…å…¬å¼é€‰æ‹©ç¬¦
        skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //é¿å¼€æŸäº›æ ‡ç­¾
      },
      "HTML-CSS": {
        availableFonts: ["STIX", "TeX"], //å¯é€‰å­—ä½“
        showMathMenu: false //å…³é—­å³å‡»èœå•æ˜¾ç¤º
      }
    }

    let mathjaxInterval = setInterval(() => {
      if(!window.MathJax){
        return;
      }
      window.MathJax.Hub.Config(mathjaxConfig)
      window.MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.getElementById('app')])

      clearInterval(mathjaxInterval)
    }, 10)    
  })()
</script>
    

    <script src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script>
<script async>
  let fancyTimer = setInterval(function(){
    if(!window.$){
      return;
    }
    $(document).ready(function() {
      $(".post img").each(function () {
        if($(this).parent().get(0).tagName.toLowerCase() === "a") {
          return;
        }
        // $(this).attr("data-fancybox", "gallery"); // if you add 'data-fancybox', img will display after showed
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "gallery");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      });
      
      clearInterval(fancyTimer);
    });
  }, 10);
</script>

    
  </body>

</html>
